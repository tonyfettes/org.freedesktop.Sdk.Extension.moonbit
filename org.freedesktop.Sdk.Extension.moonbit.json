{
  "id": "org.freedesktop.Sdk.Extension.moonbit",
  "branch": "23.08",
  "runtime": "org.freedesktop.Sdk",
  "build-extension": true,
  "sdk": "org.freedesktop.Sdk",
  "runtime-version": "23.08",
  "separate-locales": false,
  "appstream-compose": false,
  "modules": [
    {
      "name": "moonbit",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "archive",
          "only-arches": [
            "x86_64"
          ],
          "url": "https://cli.moonbitlang.com/binaries/latest/moonbit-linux-x86_64.tar.gz",
          "sha256": "e368daf804ef755aad4ae7e6fa3d521d0e65db81a5b2d5520c012b996ab20822"
        }
      ],
      "build-commands": [
        "install -d /usr/lib/sdk/moonbit/bin",
        "chmod a+x moon*",
        "cp -rpv * /usr/lib/sdk/moonbit/bin/"
      ]
    },
    {
      "name": "core",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "archive",
          "url": "https://cli.moonbitlang.com/cores/core-latest.tar.gz",
          "sha256": "52724219870724d58faa041c8097bba78a86c7ea24458b68a89c4173b4f1ce64"
        }
      ],
      "build-commands": [
        "install -d /usr/lib/sdk/moonbit/lib",
        "cp -rpv * /usr/lib/sdk/moonbit/lib/",
        "MOON_HOME=/usr/lib/sdk/moonbit PATH=/usr/lib/sdk/moonbit/bin moon bundle --all --source-dir /usr/lib/sdk/moonbit/lib/core"
      ]
    },
    {
      "name": "registry",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "git",
          "url": "https://mooncakes.io/git/index",
          "branch": "main"
        }
      ],
      "build-commands": [
        "install -d /usr/lib/sdk/moonbit/registry/index",
        "cp -rpv * /usr/lib/sdk/moonbit/registry/index"
      ]
    },
    {
      "name": "scripts",
      "sources": [
        {
          "type": "script",
          "commands": [
            "export MOON_HOME=/usr/lib/sdk/moonbit",
            "export PATH=$PATH:$MOON_HOME/bin"
          ],
          "dest-filename": "enable.sh"
        }
      ],
      "buildsystem": "simple",
      "build-commands": [
        "install -Dm755 enable.sh /usr/lib/sdk/moonbit/enable.sh"
      ]
    },
    {
      "name": "metainfo",
      "buildsystem": "simple",
      "build-commands": [
        "install -Dm644 org.freedesktop.Sdk.Extension.moonbit.metainfo.xml ${FLATPAK_DEST}/share/metainfo/org.freedesktop.Sdk.Extension.moonbit.metainfo.xml",
        "appstream-compose  --basename=org.freedesktop.Sdk.Extension.moonbit --prefix=${FLATPAK_DEST} --origin=flatpak org.freedesktop.Sdk.Extension.moonbit"
      ],
      "sources": [
        {
          "type": "file",
          "path": "org.freedesktop.Sdk.Extension.moonbit.metainfo.xml"
        }
      ]
    }
  ]
}
